const express = require('express');
const router = express.Router();
const db = require('../database');
const { sendSubscriptionEmail } = require('../utils/email');

// –ü—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è –¥–ª—è –∫–æ–∂–Ω–æ—ó –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
const greetings = {
  'colorant': [
    'üéÑ –ù–µ—Ö–∞–π –∫–æ–∂–µ–Ω –¥–µ–Ω—å –±—É–¥–µ —Ä–æ–∑—Ñ–∞—Ä–±–æ–≤–∞–Ω–∏–π —É —è—Å–∫—Ä–∞–≤—ñ –≤—ñ–¥—Ç—ñ–Ω–∫–∏ —É—Å–ø—ñ—Ö—É!',
    'üíö –ù–æ–≤–∏–π —Ä—ñ–∫ ‚Äî —á–∞—Å –º—Ä—ñ—è—Ç–∏ —Å–º—ñ–ª–∏–≤–æ, –¥—ñ—è—Ç–∏ –≤–ø–µ–≤–Ω–µ–Ω–æ –π –∂–∏—Ç–∏ –∫–æ–ª—å–æ—Ä–æ–≤–æ!',
    'üß† –ë–∞–∂–∞—î–º–æ, —â–æ–± –Ω–æ–≤–æ—Ä—ñ—á–Ω—ñ –±–∞–∂–∞–Ω–Ω—è –∑–±—É–≤–∞–ª–∏—Å—è —à–≤–∏–¥—à–µ, –Ω—ñ–∂ –≤–∏—Å–∏—Ö–∞—î —Ñ–∞—Ä–±–∞.',
    '‚ú®–•–∞–π –∫–æ–∂–µ–Ω –ø—Ä–æ–µ–∫—Ç –ø—Ä–∏–Ω–æ—Å–∏—Ç—å –ø—Ä–∏–±—É—Ç–æ–∫ —ñ –∑–∞–¥–æ–≤–æ–ª–µ–Ω–Ω—è!',
    'üéÑ –ö–æ–ª–∏ –≤—ñ—Ä–∏—Ç–µ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –≤—ñ–Ω –∑–∞–≤–∂–¥–∏ –≤–∏—Ö–æ–¥–∏—Ç—å –±–µ–∑–¥–æ–≥–∞–Ω–Ω–∏–º.',
    '‚ú®–•–∞–π –Ω–æ–≤–∏–π —Ä—ñ–∫ –±—É–¥–µ –∫–æ–ª—å–æ—Ä–æ–≤–∏–º, —è–∫ –≤–µ—Å–µ–ª–∫–∞ –ø—ñ—Å–ª—è –¥–æ—â—É!',
    'üéÑ –ù–µ—Ö–∞–π –ù–æ–≤–∏–π —Ä—ñ–∫ —Ä–æ–∑—Ñ–∞—Ä–±—É—î –≤–∞—à—ñ –¥–Ω—ñ —É —è—Å–∫—Ä–∞–≤—ñ –≤—ñ–¥—Ç—ñ–Ω–∫–∏ —É—Å–ø—ñ—Ö—É!',
    '‚ú®–ë–∞–∂–∞—î–º–æ, —â–æ–± —É 2026-–º—É –≤—Å—ñ –±–∞—Ä–≤–∏ –∂–∏—Ç—Ç—è –±—É–ª–∏ –Ω–∞—Å–∏—á–µ–Ω–∏–º–∏!',
    'üéÑ –í–∞—à —Ä—ñ–∫ –±—É–¥–µ –∫–æ–ª—å–æ—Ä–æ–≤–∏–º, —è–∫ –ø–∞–ª—ñ—Ç—Ä–∞ –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è!',
    'üß† –•–∞–π –∫–æ–∂–µ–Ω –¥–µ–Ω—å –Ω–æ–≤–æ–≥–æ —Ä–æ–∫—É –º–∞—î —Å–≤—ñ–π –≤—ñ–¥—Ç—ñ–Ω–æ–∫ —â–∞—Å—Ç—è.',
    '‚ú®–•–∞–π —É –ù–æ–≤–æ–º—É —Ä–æ—Ü—ñ –∫–æ–∂–µ–Ω –ø—Ä–æ–µ–∫—Ç –±—É–¥–µ –≤–¥–∞–ª–∏–º, —è–∫ —ñ–¥–µ–∞–ª—å–Ω–æ –ø—ñ–¥—ñ–±—Ä–∞–Ω–∏–π –∫–æ–ª—ñ—Ä.',
    'üéÑ –ù–µ—Ö–∞–π –±—ñ–∑–Ω–µ—Å –±—É–¥–µ —è—Å–∫—Ä–∞–≤–∏–º, —è–∫ —Å–≤—ñ–∂–µ –ø–æ–∫—Ä–∏—Ç—Ç—è –ø—ñ—Å–ª—è –∑–º—ñ—à—É–≤–∞–Ω–Ω—è –∫–æ–ª—å–æ—Ä—ñ–≤.',
    'üß† –•–∞–π —É –≤–∞—à–æ–º—É –∂–∏—Ç—Ç—ñ –±—É–¥–µ –±—ñ–ª—å—à–µ –±–∞—Ä–≤, –Ω—ñ–∂ —É –±—É–¥—å-—è–∫—ñ–π –ø–∞–ª—ñ—Ç—Ä—ñ —Å–≤—ñ—Ç—É!'
  ],
  'mix': [
    'üåü –•–∞–π 2026 –±—É–¥–µ —Ä–æ–∫–æ–º –Ω–æ–≤–∏—Ö –≤—ñ–¥—Ç—ñ–Ω–∫—ñ–≤, —è—Å–∫—Ä–∞–≤–∏—Ö —Ñ–∞—Ä–± —ñ —á–∏—Å—Ç–∏—Ö –µ–º–æ—Ü—ñ–π!',
    'üéÑ –ö–æ–ª–∏ –µ–º–æ—Ü—ñ—ó –∑–º—ñ—à–∞–Ω—ñ —É –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –ø—Ä–æ–ø–æ—Ä—Ü—ñ—è—Ö, —Ä—ñ–∫ —Ä–æ–∑–∫–≤—ñ—Ç–∞—î –Ω–æ–≤–∏–º–∏ –±–∞—Ä–≤–∞–º–∏!',
    'üíú –£ –Ω–æ–≤–æ–º—É —Ä–æ—Ü—ñ –∑–º—ñ—à—É–π—Ç–µ —Ç—ñ–ª—å–∫–∏ —â–∞—Å–ª–∏–≤—ñ –∫–æ–ª—å–æ—Ä–∏ –π —Å—Ç–≤–æ—Ä—é–π—Ç–µ –≤–ª–∞—Å–Ω—ñ —à–µ–¥–µ–≤—Ä–∏!',
    'üéÑ –ö–æ–∂–Ω–∞ –∫—Ä–∞–ø–ª—è —Ñ–∞—Ä–±–∏ –≤ –Ω–æ–≤–æ–º—É —Ä–æ—Ü—ñ  –±—É–¥–µ –∑–∞–±–∞—Ä–≤–ª–µ–Ω–∞ —è—Å–∫—Ä–∞–≤–∏–º–∏ –µ–º–æ—Ü—ñ—è–º–∏.',
    'üéÑ –ù–µ—Ö–∞–π —Ä–æ–±–æ—Ç–∞ –Ω–∞–¥–∏—Ö–∞—î –≤–∞—Å –µ–Ω–µ—Ä–≥—ñ—î—é, –∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∏–Ω–æ—Å–∏—Ç—å —Å–ø—Ä–∞–≤–∂–Ω—î –∑–∞–¥–æ–≤–æ–ª–µ–Ω–Ω—è!',
    'üéÑ –ö–æ–ª—å–æ—Ä–∏ —Ç–≤–æ–≥–æ —É—Å–ø—ñ—Ö—É —Å—å–æ–≥–æ–¥–Ω—ñ –∑–º—ñ—à–∞—é—Ç—å—Å—è —ñ–¥–µ–∞–ª—å–Ω–æ.',
    'üéÑ –ù–µ—Ö–∞–π —à–µ–π–∫–µ—Ä –¥–æ–ª—ñ –º–∞–π—Å—Ç–µ—Ä–Ω–æ –∑–º—ñ—à—É—î —É –≤–∞—à–æ–º—É –∂–∏—Ç—Ç—ñ –ª–∏—à–µ –Ω–∞–π–∫—Ä–∞—â—ñ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏ ‚Äî —Å–ø–æ–∫—ñ–π —ñ –≤–Ω—É—Ç—Ä—ñ—à–Ω—é —Å–∏–ª—É, —Å—è–π–≤–æ —Ç–∞ –ª–µ–≥–∫—ñ—Å—Ç—å, –¥–æ—Å—Ç–∞—Ç–æ–∫ —Ç–∞ –¥–æ–±—Ä–æ–±—É—Ç.',
    'üíö –ë–∞–∂–∞—î–º–æ, —â–æ–± –ø–∞–ª—ñ—Ç—Ä–∞ –≤–∞—à–æ–≥–æ —Ä–æ–∫—É –±—É–ª–∞ –±–µ–∑–¥–æ–≥–∞–Ω–Ω–æ –≥–∞—Ä–º–æ–Ω—ñ–π–Ω–æ—é!',
    'üéÜ –ù–µ—Ö–∞–π —Ñ–∞—Ä–±–∏ –≤–∞—à–∏—Ö —ñ–¥–µ–π –Ω—ñ–∫–æ–ª–∏ –Ω–µ —Ç—å–º—è–Ω—ñ—é—Ç—å, –∞ –ª–∏—à–µ —Å—è—é—Ç—å —è—Å–∫—Ä–∞–≤—ñ—à–µ!',
    'üéÑ –•–∞–π —Ç–≤—ñ–π –¥–æ–∑–∞—Ç–æ—Ä –Ω—ñ–∫–æ–ª–∏ –Ω–µ –¥–æ–∑—É—î –º–µ–Ω—à–µ —è—Å–∫—Ä–∞–≤–∏—Ö  –µ–º–æ—Ü—ñ–π, –Ω—ñ–∂ —Ç–∏ –∑–∞—Å–ª—É–≥–æ–≤—É—î—à!',
    'üéÑ –•–∞–π –∂–∏—Ç—Ç—è –ø—Ä–∞—Ü—é—î –±–µ–∑ –∑–±–æ—ó–≤ ‚Äî —É —Ä–µ–∂–∏–º—ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ —â–∞—Å—Ç—è!',
    'üéÑ –•–∞–π –∂–∏—Ç—Ç—è –æ–±–µ—Ä—Ç–∞—î—Ç—å—Å—è –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ñ–π —à–≤–∏–¥–∫–æ—Å—Ç—ñ —É—Å–ø—ñ—Ö—É!',
    'üéÑ –í–∞—à –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π —à–ª—è—Ö ‚Äî —è–∫ —Ä—ñ–≤–Ω–æ–º—ñ—Ä–Ω–µ –∑–º—ñ—à—É–≤–∞–Ω–Ω—è –∫–æ–ª—å–æ—Ä—É: –±–µ–∑ –ø–ª—è–º —ñ –ø–∞—É–∑.',
    'üéÑ –ù–µ—Ö–∞–π —Å–∏—Å—Ç–µ–º–∞ –∑–∞–≤–∂–¥–∏ ¬´–æ–Ω–ª–∞–π–Ω¬ª ‚Äî –±–µ–∑ –∑–∞–≤–∏—Å–∞–Ω—å —ñ –∑–±–æ—ó–≤ —É–¥–∞—á—ñ!',
    'üéÑ –†—ñ–∫ –±—É–¥–µ —è—Å–∫—Ä–∞–≤–∏–º, —è–∫ –∫–æ–ª–æ—Ä–∞–Ω—Ç —É –∫–æ–ª–±—ñ!',
    'üß™ –•–∞–π —É —Ñ–æ—Ä–º—É–ª—ñ –≤–∞—à–æ–≥–æ –∂–∏—Ç—Ç—è –∑–∞–≤–∂–¥–∏ –±—É–¥–µ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è –π –Ω–∞—Å–∏—á–µ–Ω–∏—Ö –ø—ñ–≥–º–µ–Ω—Ç—ñ–≤ —Ä–∞–¥–æ—Å—Ç—ñ',
    'üéÑ –í–∞—à–µ —Å–µ—Ä—Ü–µ ‚Äî –Ω–∞–π–∫—Ä–∞—â–µ –º—ñ—Å—Ü–µ –¥–ª—è –∑–º—ñ—à—É–≤–∞–Ω–Ω—è –Ω–∞–π—Ç–µ–ø–ª—ñ—à–∏—Ö –µ–º–æ—Ü—ñ–π!',
    'üéÑ –ù–µ—Ö–∞–π –∂–æ–¥–Ω–∞ –∫—Ä–∞–ø–ª—è –º–æ–∂–ª–∏–≤–æ—Å—Ç–µ–π –Ω–µ –∑–∞–ª–∏—à–∏—Ç—å—Å—è –Ω–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ—é!',
    'üéÑ –•–∞–π —Ñ–∞—Ä–±–∏ –∂–∏—Ç—Ç—è –Ω–µ —Ç—å–º—è–Ω—ñ—é—Ç—å, –Ω–∞–≤—ñ—Ç—å –∫–æ–ª–∏ –¥–µ–Ω—å —Å—ñ—Ä–∏–π.'
  ],
  'bruker-o': [
    'üéØ –ù–µ—Ö–∞–π —É—Å—ñ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—á–Ω—ñ –ø—Ä–æ—Ü–µ—Å–∏ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ä–æ–∫—É –±—É–¥—É—Ç—å —Ç–æ—á–Ω–∏–º–∏ —Ç–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–∏–º–∏.',
    'üåü –•–∞–π —É—Å—ñ —Ç–µ—Å—Ç–∏ –π –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è –≤ 2026 —Ä–æ—Ü—ñ –ø—Ä–æ—Ö–æ–¥—è—Ç—å –±–µ–∑ –≤—ñ–¥—Ö–∏–ª–µ–Ω—å —ñ –∫–æ–ª–∏–≤–∞–Ω—å..',
    'üéÑ –¢–æ—á–Ω—ñ—Å—Ç—å —ñ —è–∫—ñ—Å—Ç—å —Å—Ç–∞–Ω—É—Ç—å —Ç–≤–æ—ó–º–∏ —Å–æ—é–∑–Ω–∏–∫–∞–º–∏ 2026 —Ä–æ—Ü—ñ.',
    'üíö –ü—Ä–∏–ª–∞–¥–∏ –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏–º—É—Ç—å —Ç–∞–∫—ñ –≥–∞—Ä–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏, —â–æ —Ç–∏ –∑–∞–ø—ñ–¥–æ–∑—Ä–∏—à —ó—Ö –≤ –ø—ñ–¥–ª–∞–±—É–∑–Ω–∏—Ü—Ç–≤—ñ.',
    'üéÑ –•–∞–π —è–∫—ñ—Å–Ω—ñ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤ –±—É–¥—É—Ç—å –Ω–µ–∑–º—ñ–Ω–Ω–æ –≤–∏—Å–æ–∫–∏–º–∏ –≤ 2026 —Ä–æ—Ü—ñ.',
    'üåü –ù–µ—Ö–∞–π —É—Å—ñ —Ç–µ—Å—Ç–∏ –π –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ä–æ–∫—É –ø—Ä–æ—Ö–æ–¥—è—Ç—å –±–µ–∑ –≤—ñ–¥—Ö–∏–ª–µ–Ω—å —ñ –∫–æ–ª–∏–≤–∞–Ω—å.',
    'üíö –¢–æ—á–Ω—ñ—Å—Ç—å —ñ —è–∫—ñ—Å—Ç—å —Å—Ç–∞–Ω—É—Ç—å —Ç–≤–æ—ó–º–∏ —Å–æ—é–∑–Ω–∏–∫–∞–º–∏ –≤ 2026 —Ä–æ—Ü—ñ.',
    'üéØ –¢–æ—á–Ω—ñ—Å—Ç—å –∞–Ω–∞–ª—ñ–∑—É –≤ –ù–æ–≤–æ–º—É —Ä–æ—Ü—ñ —Å—Ç–∞–Ω–µ –∫–ª—é—á–µ–º –¥–æ –Ω–æ–≤–æ–≥–æ —É—Å–ø—ñ—Ö—É.'
  ],
  'axs': [
    'üåà –•–∞–π —É —Å–ø–µ–∫—Ç—Ä—ñ –≤–∞—à–æ–≥–æ –∂–∏—Ç—Ç—è –ø–µ—Ä–µ–¥ –≤–∞–º–∏ —Å–ø–∞–ª–∞—Ö–Ω—É—Ç—å –ª–∏—à–µ —Å–≤—ñ—Ç–ª—ñ —Ö–≤–∏–ª—ñ —Ä–∞–¥–æ—Å—Ç—ñ!',
    'üéÜ –ù–µ—Ö–∞–π –≤–∞—à–µ –∂–∏—Ç—Ç—è –∑–∞–≤–∂–¥–∏ –±—É–¥–µ —Ç–æ—á–Ω–æ –≤—ñ–¥–∫–∞–ª—ñ–±—Ä–æ–≤–∞–Ω–µ –Ω–∞ —É—Å–ø—ñ—Ö!',
    'üî¨ –£ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—ó 2026 —Ö–∞–π –ø–∞–Ω—É—î –≥–∞—Ä–º–æ–Ω—ñ—è, –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è –π –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è!',
    'üí´ –ë–∞–∂–∞—î–º–æ, —â–æ–± –≤–∞—à —Å–ø–µ–∫—Ç—Ä–æ–º–µ—Ç—Ä –±–∞—á–∏–≤ —Ç—ñ–ª—å–∫–∏ –ø–æ–∑–∏—Ç–∏–≤–Ω—ñ —á–∞—Å—Ç–æ—Ç–∏!',
    'üß™ –•–∞–π —ñ–Ω—Ç–µ—Ä—Ñ–µ—Ä–æ–º–µ—Ç—Ä –¥–æ–ª—ñ –∑–∞–≤–∂–¥–∏ –ø–æ–∫–∞–∑—É—î —á—ñ—Ç–∫—É –∫–∞—Ä—Ç–∏–Ω—É —â–∞—Å—Ç—è!',
    'üéØ –£ –ù–æ–≤–æ–º—É —Ä–æ—Ü—ñ –±–∞–∂–∞—î–º–æ —Ç–æ—á–Ω–æ—Å—Ç—ñ –≤ –¥—ñ—è—Ö —ñ —è—Å–Ω–æ—Å—Ç—ñ –≤ —Ü—ñ–ª—è—Ö ‚Äî —è–∫ —É –ø—Ä–∏–ª–∞–¥—ñ–≤ Bruker!',
    'üíé –•–∞–π –≤–∞—à–∞ —è–∫—ñ—Å—Ç—å –∂–∏—Ç—Ç—è —Å—è–≥–∞—î —Ä—ñ–≤–Ω—è "–ø—Ä–µ–º—ñ—É–º-–∫–∞–ª—ñ–±—Ä—É–≤–∞–Ω–Ω—è"!',
    'üåü –ë–∞–∂–∞—î–º–æ, —â–æ–± —É—Å—ñ –≤–∞—à—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ —É 2026 —Ä–æ—Ü—ñ –≤–ø–µ–≤–Ω–µ–Ω–æ –≤–∏—Ö–æ–¥–∏–ª–∏ –∑–∞ —Ä–∞–º–∫–∏ –∑–≤–∏—á–Ω–∏—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ñ–≤.',
    '‚öóÔ∏è –ù–µ—Ö–∞–π –∫–æ–∂–µ–Ω –¥–µ–Ω—å –ù–æ–≤–æ–≥–æ —Ä–æ–∫—É –±—É–¥–µ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–º, —â–æ –¥–∞—Ä—É—î –ø–æ–∑–∏—Ç–∏–≤ —ñ –≤—ñ–¥–∫—Ä–∏–≤–∞—î —à–ª—è—Ö –¥–æ –Ω–æ–≤–æ–≥–æ!',
    'üåü –ù–µ—Ö–∞–π –∫–æ–∂–µ–Ω –∫—Ä–æ–∫, –∑—Ä–æ–±–ª–µ–Ω–∏–π –∑—ñ —Å–º—ñ–ª–∏–≤—ñ—Å—Ç—é, –ø—Ä–∏–≤–æ–¥–∏—Ç—å –¥–æ —É—Å–ø—ñ—Ö—É.'
  ],
  'filter': [
    'üíß –ù–µ—Ö–∞–π –ù–æ–≤–∏–π —Ä—ñ–∫ –≤—ñ–¥—Ñ—ñ–ª—å—Ç—Ä–æ–≤—É—î –≤—Å–µ –∑–∞–π–≤–µ, –∑–∞–ª–∏—à–∞—é—á–∏ —Ç—ñ–ª—å–∫–∏ –¥–æ–±—Ä–æ –π —Å–≤—ñ—Ç–ª—ñ –ø–æ—á—É—Ç—Ç—è.',
    'üéÑ –ë–∞–∂–∞—î–º–æ, —â–æ–± —Ñ—ñ–ª—å—Ç—Ä–∏ –ª–æ–≤–∏–ª–∏ –ª–∏—à–µ —â–∞—Å—Ç—è, –∞ –Ω–µ —Ç—É—Ä–±–æ—Ç–∏!',
    '‚ú® –ù–µ—Ö–∞–π —É –∫–æ—Ä–ø—É—Å—ñ –≤–∞—à–æ–≥–æ —Å–µ—Ä—Ü—è –±—É–¥–µ –ª–∏—à–µ —Å–≤—ñ—Ç–ª–æ, —Ç–µ–ø–ª–æ –π –ª—é–±–æ–≤!',
    'üí¶ –£ 2026 —Ö–∞–π —É—Å—ñ –ø—Ä–æ–±–ª–µ–º–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç—å —á–µ—Ä–µ–∑ —Ñ—ñ–ª—å—Ç—Ä —ñ –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –ø–æ–∑–∞–¥—É!',
    '‚öôÔ∏è –•–∞–π –∫–æ–∂–µ–Ω –∫–∞—Ä—Ç—Ä–∏–¥–∂ –Ω–æ–≤–æ–≥–æ –¥–Ω—è –Ω–∞–ø–æ–≤–Ω—é—î—Ç—å—Å—è –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è–º —ñ —É—Å–ø—ñ—Ö–æ–º!',
    'üéÅ –ë–∞–∂–∞—î–º–æ, —â–æ–± –≤–∞—à —Ñ—ñ–ª—å—Ç—Ä –∂–∏—Ç—Ç—è –ø—Ä–∞—Ü—é–≤–∞–≤ –±–µ–∑ –∑–∞—Å–º—ñ—á–µ–Ω—å —ñ –∑ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ—é –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—é!',
    'üåü –ù–µ—Ö–∞–π —É—Å—ñ –Ω–µ–≥–∞—Ç–∏–≤–∏ –∑–∞—Ç—Ä–∏–º—É—é—Ç—å—Å—è –º—ñ—à–µ—á–Ω–∏–º —Ñ—ñ–ª—å—Ç—Ä–æ–º, –∞ –≤ –¥—É—à—É –ø–æ—Ç—Ä–∞–ø–ª—è—î –ª–∏—à–µ —á–∏—Å—Ç–∞ —Ä–∞–¥—ñ—Å—Ç—å!',
    'üíß –£ –Ω–æ–≤–æ–º—É —Ä–æ—Ü—ñ —Ö–∞–π –∫–æ—Ä–ø—É—Å –≤–∞—à–æ—ó –º—Ä—ñ—ó –±—É–¥–µ –º—ñ—Ü–Ω–∏–º, –∞ —Ñ—ñ–ª—å—Ç—Ä–∏ ‚Äî –Ω–∞–¥—ñ–π–Ω–∏–º–∏!',
    'üß© –ë–∞–∂–∞—î–º–æ, —â–æ–± –≤–∞—à –∫–∞—Ä—Ç—Ä–∏–¥–∂ —â–∞—Å—Ç—è –Ω—ñ–∫–æ–ª–∏ –Ω–µ –ø–æ—Ç—Ä–µ–±—É–≤–∞–≤ –∑–∞–º—ñ–Ω–∏!'
  ],
  'lab': [
    'üåü –•–∞–π 2026 –±—É–¥–µ —Ä–æ–∫–æ–º –Ω–æ–≤–∏—Ö –≤—ñ–¥—Ç—ñ–Ω–∫—ñ–≤, —è—Å–∫—Ä–∞–≤–∏—Ö —Ñ–∞—Ä–± —ñ —á–∏—Å—Ç–∏—Ö –µ–º–æ—Ü—ñ–π!',
    'üéÑ –ö–æ–ª–∏ –µ–º–æ—Ü—ñ—ó –∑–º—ñ—à–∞–Ω—ñ —É –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –ø—Ä–æ–ø–æ—Ä—Ü—ñ—è—Ö, —Ä—ñ–∫ —Ä–æ–∑–∫–≤—ñ—Ç–∞—î –Ω–æ–≤–∏–º–∏ –±–∞—Ä–≤–∞–º–∏!',
    'üíú –£ –Ω–æ–≤–æ–º—É —Ä–æ—Ü—ñ –∑–º—ñ—à—É–π—Ç–µ —Ç—ñ–ª—å–∫–∏ —â–∞—Å–ª–∏–≤—ñ –∫–æ–ª—å–æ—Ä–∏ –π —Å—Ç–≤–æ—Ä—é–π—Ç–µ –≤–ª–∞—Å–Ω—ñ —à–µ–¥–µ–≤—Ä–∏!',
    'üéÑ –ö–æ–∂–Ω–∞ –∫—Ä–∞–ø–ª—è —Ñ–∞—Ä–±–∏ –≤ –Ω–æ–≤–æ–º—É —Ä–æ—Ü—ñ  –±—É–¥–µ –∑–∞–±–∞—Ä–≤–ª–µ–Ω–∞ —è—Å–∫—Ä–∞–≤–∏–º–∏ –µ–º–æ—Ü—ñ—è–º–∏.',
    'üéÑ –ù–µ—Ö–∞–π —Ä–æ–±–æ—Ç–∞ –Ω–∞–¥–∏—Ö–∞—î –≤–∞—Å –µ–Ω–µ—Ä–≥—ñ—î—é, –∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∏–Ω–æ—Å–∏—Ç—å —Å–ø—Ä–∞–≤–∂–Ω—î –∑–∞–¥–æ–≤–æ–ª–µ–Ω–Ω—è!',
    'üéÑ –ö–æ–ª—å–æ—Ä–∏ —Ç–≤–æ–≥–æ —É—Å–ø—ñ—Ö—É —Å—å–æ–≥–æ–¥–Ω—ñ –∑–º—ñ—à–∞—é—Ç—å—Å—è —ñ–¥–µ–∞–ª—å–Ω–æ.',
    'üéÑ –ù–µ—Ö–∞–π —à–µ–π–∫–µ—Ä –¥–æ–ª—ñ –º–∞–π—Å—Ç–µ—Ä–Ω–æ –∑–º—ñ—à—É—î —É –≤–∞—à–æ–º—É –∂–∏—Ç—Ç—ñ –ª–∏—à–µ –Ω–∞–π–∫—Ä–∞—â—ñ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏ ‚Äî —Å–ø–æ–∫—ñ–π —ñ –≤–Ω—É—Ç—Ä—ñ—à–Ω—é —Å–∏–ª—É, —Å—è–π–≤–æ —Ç–∞ –ª–µ–≥–∫—ñ—Å—Ç—å, –¥–æ—Å—Ç–∞—Ç–æ–∫ —Ç–∞ –¥–æ–±—Ä–æ–±—É—Ç.',
    'üíö –ë–∞–∂–∞—î–º–æ, —â–æ–± –ø–∞–ª—ñ—Ç—Ä–∞ –≤–∞—à–æ–≥–æ —Ä–æ–∫—É –±—É–ª–∞ –±–µ–∑–¥–æ–≥–∞–Ω–Ω–æ –≥–∞—Ä–º–æ–Ω—ñ–π–Ω–æ—é!',
    'üéÜ –ù–µ—Ö–∞–π —Ñ–∞—Ä–±–∏ –≤–∞—à–∏—Ö —ñ–¥–µ–π –Ω—ñ–∫–æ–ª–∏ –Ω–µ —Ç—å–º—è–Ω—ñ—é—Ç—å, –∞ –ª–∏—à–µ —Å—è—é—Ç—å —è—Å–∫—Ä–∞–≤—ñ—à–µ!',
    'üéÑ –•–∞–π —Ç–≤—ñ–π –¥–æ–∑–∞—Ç–æ—Ä –Ω—ñ–∫–æ–ª–∏ –Ω–µ –¥–æ–∑—É—î –º–µ–Ω—à–µ —è—Å–∫—Ä–∞–≤–∏—Ö  –µ–º–æ—Ü—ñ–π, –Ω—ñ–∂ —Ç–∏ –∑–∞—Å–ª—É–≥–æ–≤—É—î—à!',
    'üéÑ –•–∞–π –∂–∏—Ç—Ç—è –ø—Ä–∞—Ü—é—î –±–µ–∑ –∑–±–æ—ó–≤ ‚Äî —É —Ä–µ–∂–∏–º—ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ —â–∞—Å—Ç—è!',
    'üéÑ –•–∞–π –∂–∏—Ç—Ç—è –æ–±–µ—Ä—Ç–∞—î—Ç—å—Å—è –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ñ–π —à–≤–∏–¥–∫–æ—Å—Ç—ñ —É—Å–ø—ñ—Ö—É!',
    'üéÑ –í–∞—à –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π —à–ª—è—Ö ‚Äî —è–∫ —Ä—ñ–≤–Ω–æ–º—ñ—Ä–Ω–µ –∑–º—ñ—à—É–≤–∞–Ω–Ω—è –∫–æ–ª—å–æ—Ä—É: –±–µ–∑ –ø–ª—è–º —ñ –ø–∞—É–∑.',
    'üéÑ –ù–µ—Ö–∞–π —Å–∏—Å—Ç–µ–º–∞ –∑–∞–≤–∂–¥–∏ ¬´–æ–Ω–ª–∞–π–Ω¬ª ‚Äî –±–µ–∑ –∑–∞–≤–∏—Å–∞–Ω—å —ñ –∑–±–æ—ó–≤ —É–¥–∞—á—ñ!',
    'üéÑ –†—ñ–∫ –±—É–¥–µ —è—Å–∫—Ä–∞–≤–∏–º, —è–∫ –∫–æ–ª–æ—Ä–∞–Ω—Ç —É –∫–æ–ª–±—ñ!',
    'üß™ –•–∞–π —É —Ñ–æ—Ä–º—É–ª—ñ –≤–∞—à–æ–≥–æ –∂–∏—Ç—Ç—è –∑–∞–≤–∂–¥–∏ –±—É–¥–µ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è –π –Ω–∞—Å–∏—á–µ–Ω–∏—Ö –ø—ñ–≥–º–µ–Ω—Ç—ñ–≤ —Ä–∞–¥–æ—Å—Ç—ñ',
    'üéÑ –í–∞—à–µ —Å–µ—Ä—Ü–µ ‚Äî –Ω–∞–π–∫—Ä–∞—â–µ –º—ñ—Å—Ü–µ –¥–ª—è –∑–º—ñ—à—É–≤–∞–Ω–Ω—è –Ω–∞–π—Ç–µ–ø–ª—ñ—à–∏—Ö –µ–º–æ—Ü—ñ–π!',
    'üéÑ –ù–µ—Ö–∞–π –∂–æ–¥–Ω–∞ –∫—Ä–∞–ø–ª—è –º–æ–∂–ª–∏–≤–æ—Å—Ç–µ–π –Ω–µ –∑–∞–ª–∏—à–∏—Ç—å—Å—è –Ω–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ—é!',
    'üéÑ –•–∞–π —Ñ–∞—Ä–±–∏ –∂–∏—Ç—Ç—è –Ω–µ —Ç—å–º—è–Ω—ñ—é—Ç—å, –Ω–∞–≤—ñ—Ç—å –∫–æ–ª–∏ –¥–µ–Ω—å —Å—ñ—Ä–∏–π.'
  ]
};

// –ú–∞–ø—ñ–Ω–≥ URL –∫–∞—Ç–µ–≥–æ—Ä—ñ–π –¥–æ –Ω–∞–∑–≤ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π –≤ –ë–î
const categoryMapping = {
  'colorant': '–ö–æ–ª–æ—Ä–∞–Ω—Ç–∏',
  'mix': '–ö–æ–ª—ñ—Ä—É–≤–∞–ª—å–Ω–µ –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è',
  'bruker-o': '–ë—Ä—É–∫–µ—Ä –û–ø—Ç—ñ–∫—Å (–ë–Ü–ß)',
  'axs': '–ë—Ä—É–∫–µ—Ä –ê–•–°',
  'filter': '–§—ñ–ª—å—Ç—Ä–∏',
  'lab': '–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∫–∞'
};

// –û—Ç—Ä–∏–º–∞—Ç–∏ —Ä–∞–Ω–¥–æ–º–Ω–µ –ø—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
router.get('/:category', (req, res) => {
  const { category } = req.params;
  
  if (!greetings[category]) {
    return res.status(404).json({ error: 'Category not found' });
  }
  
  const categoryGreetings = greetings[category];
  const randomIndex = Math.floor(Math.random() * categoryGreetings.length);
  const randomGreeting = categoryGreetings[randomIndex];
  
  res.json({
    category,
    greeting: randomGreeting
  });
});

// –û—Ç—Ä–∏–º–∞—Ç–∏ —Ç–æ–≤–∞—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó (–±–µ–∑ —Ü—ñ–Ω, –ø—É–±–ª—ñ—á–Ω–∏–π –¥–æ—Å—Ç—É–ø)
router.get('/:category/products', (req, res) => {
  const { category } = req.params;
  const database = db.getDb();
  
  const categoryName = categoryMapping[category];
  if (!categoryName) {
    return res.status(404).json({ error: 'Category not found' });
  }
  
  database.all(`
    SELECT 
      p.id,
      p.name,
      p.image_url,
      p.card_color,
      c.name as category_name
    FROM products p
    JOIN categories c ON p.category_id = c.id
    WHERE c.name = ?
    ORDER BY p.name
  `, [categoryName], (err, products) => {
    if (err) {
      return res.status(500).json({ error: err.message });
    }
    res.json(products);
  });
});

// –ó–±–µ—Ä–µ–≥—Ç–∏ email –¥–ª—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó
router.post('/register-email', async (req, res) => {
  const { email, category } = req.body;
  
  if (!email || !email.includes('@')) {
    return res.status(400).json({ error: 'Valid email is required' });
  }
  
  const database = db.getDb();
  
  try {
    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ email –≤–∂–µ —ñ—Å–Ω—É—î –≤ –ø—ñ–¥–ø–∏—Å–∫–∞—Ö
    const existing = await new Promise((resolve, reject) => {
      database.get('SELECT id FROM email_subscriptions WHERE email = ?', [email], (err, row) => {
        if (err) reject(err);
        else resolve(row);
      });
    });
    
    if (existing) {
      return res.json({ 
        success: true, 
        message: 'Email –≤–∂–µ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ',
        alreadyExists: true
      });
    }
    
    // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ email –≤ —Ç–∞–±–ª–∏—Ü—é –ø—ñ–¥–ø–∏—Å–æ–∫
    await new Promise((resolve, reject) => {
      database.run(
        'INSERT INTO email_subscriptions (email, category) VALUES (?, ?)',
        [email, category || null],
        function(insertErr) {
          if (insertErr) reject(insertErr);
          else resolve(this.lastID);
        }
      );
    });
    
    // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ email –Ω–∞ vikafoer@gmail.com
    const emailResult = await sendSubscriptionEmail(email, category);
    if (!emailResult.success) {
      console.warn('Failed to send notification email:', emailResult.error);
      // –ù–µ –±–ª–æ–∫—É—î–º–æ —É—Å–ø—ñ—à–Ω—É —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é, —è–∫—â–æ email –Ω–µ –≤—ñ–¥–ø—Ä–∞–≤–∏–≤—Å—è
    }
    
    res.json({ 
      success: true, 
      message: 'Email —É—Å–ø—ñ—à–Ω–æ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ',
      alreadyExists: false
    });
  } catch (error) {
    console.error('Error registering email:', error);
    res.status(500).json({ error: error.message });
  }
});

module.exports = router;

