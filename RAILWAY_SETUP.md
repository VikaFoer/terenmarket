# Railway Deployment Setup Guide

## Проблема: Втрата даних після деплою

Якщо після деплою зникають:
- Категорії
- Завантажені зображення товарів
- Інші дані з бази даних

Це означає, що база даних та файли зберігаються в ефемерній файловій системі контейнера, а не в Railway Volume.

## Рішення: Налаштування Railway Volume

### Крок 1: Створити Volume на Railway

1. Увійдіть в Railway Dashboard
2. Виберіть ваш проект
3. Перейдіть на вкладку **"Volumes"**
4. Натисніть **"New Volume"**
5. Введіть назву: `data`
6. Виберіть розмір (мінімум 1GB)
7. Натисніть **"Create"**

### Крок 2: Підключити Volume до сервісу

1. Виберіть ваш сервіс (service)
2. Перейдіть на вкладку **"Settings"**
3. Знайдіть розділ **"Volumes"**
4. Натисніть **"Add Volume"**
5. Виберіть створений Volume `data`
6. Введіть **Mount Path**: `/app/server/data`
7. Натисніть **"Add"**

### Крок 3: Налаштувати змінну середовища

1. У вашому сервісі перейдіть на вкладку **"Variables"**
2. Додайте нову змінну:
   - **Name**: `DATA_DIR`
   - **Value**: `/app/server/data`
3. Натисніть **"Add"**

### Крок 4: Перезапустити сервіс

1. Перейдіть на вкладку **"Deployments"**
2. Натисніть **"Redeploy"** або дочекайтеся автоматичного перезапуску

## Перевірка налаштування

Після деплою перевірте логи сервера. Ви повинні побачити:

```
=== Database Configuration ===
DATA_DIR: /app/server/data
DB_PATH: /app/server/data/database.sqlite
✅ Database already exists in Volume location
```

Також перевірте endpoint `/api/db-status` - він покаже, чи використовується Volume:

```json
{
  "database": {
    "isInVolume": true,
    "dataDir": "/app/server/data"
  }
}
```

## Важливо

- **DATA_DIR** має бути встановлений на `/app/server/data` (шлях до Volume)
- Volume має бути підключений до сервісу з Mount Path `/app/server/data`
- Після налаштування Volume всі дані (база даних та завантажені зображення) будуть зберігатися постійно
- Якщо Volume не налаштований, дані будуть втрачатися після кожного деплою

## Структура даних у Volume

```
/app/server/data/
├── database.sqlite          # База даних
└── uploads/
    └── images/             # Завантажені зображення товарів
        └── ...
```

## Міграція існуючих даних

Якщо у вас вже є дані в старій базі даних:

1. Після налаштування Volume сервер автоматично спробує мігрувати дані зі старого місця
2. Перевірте логи на наявність повідомлень про міграцію
3. Якщо міграція не відбулася автоматично, можна вручну скопіювати файл `database.sqlite` в Volume

